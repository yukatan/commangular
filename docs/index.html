<!DOCTYPE html><html class=no-js><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Commangular Docs</title><meta name=description content=""><meta name=viewport content="width=device-width, initial-scale=1"><!-- Place favicon.ico and apple-touch-icon(s) in the root directory --><link rel=stylesheet href=/css/db7d.main.css><script src=/js/1a53.head-scripts.js></script></head><body><!--[if lt IE 8]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]--><nav class="navbar navbar-default navbar-inverse header" role=navigation><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#bs-example-navbar-collapse-1><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=#>Commangular</a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav"><li><a href=/><i class="fa fa-home"></i>Home</a></li><li><a href=/why><i class="fa fa-question"></i>Where and Why?</a></li><li><a href=/get-started><i class="fa fa-gears"></i>Get Started</a></li><li class=active><a href=/docs><i class="fa fa-book"></i>Documentation</a></li></ul></div></nav><div class=subheader><div class="container text-center"><h1><i class="fa fa-book"></i>Docs</h1><h3>LEARN HOW TO USE COMMANGULAR</h3></div></div><div class=social-bar><div class="container text-center"><ul class=list-inline><li><iframe src="http://ghbtns.com/github-btn.html?user=yukatan&repo=commangular&type=watch&count=true" allowtransparency=true frameborder=0 scrolling=0 width=82 height=20></iframe></li><li><iframe src="http://ghbtns.com/github-btn.html?user=yukatan&repo=commangular&type=fork&count=true" allowtransparency=true frameborder=0 scrolling=0 width=80 height=20></iframe></li><li><iframe src="http://ghbtns.com/github-btn.html?user=yukatan&repo=commangular&type=follow&count=true" allowtransparency=true frameborder=0 scrolling=0 width=140 height=20></iframe></li></ul></div></div><div class="container markdown-content"><h2>Table of Contents</h2><hr><ul><li><a href=#installation>Installation</a></li><li><a href=#quick-guide>Quick guide</a></li><li><a href=#creating-commands>Creating commands</a><ul><li><a href=#commangular-namespace>Commangular namespace</a></li><li><a href=#how-to-create-commands>How to create commands</a></li><li><a href=#the-command-config-object>The command config object</a></li><li><a href=#returning-result-from-commands>Returning results from commands</a></li></ul></li><li><a href=#using-the-provider>Using the provider</a><ul><li><a href=#building-command-sequences>Building command sequences.</a></li><li><a href=#building-parallel-commands>Building parallel commands.</a></li><li><a href=#building-command-flows>Building command flows.</a></li><li><a href=#nesting-commands>Nesting commands.</a></li><li><a href=#mapping-commands-to-events>Mapping commands to events</a></li></ul></li><li><a href=#command-execution>Command execution</a><ul><li><a href=#dispatching-events>Dispatching events.</a></li><li><a href=#the-command-execution-context>The command execution context.</a></li><li><a href=#command-livecycle>Command livecycle.</a></li><li><a href=#passing-data-to-commands-at-dispatching-time>Passing data to commands at dispatching time.</a></li><li><a href=#injection-from-angular-context>Injection from angular context.</a></li><li><a href=#returning-promises-from-commands>Returning promises from commands.</a></li></ul></li><li><a href=#command-aspects-advanced-interception>Command Aspects (Advanced interception).</a><ul><li><a href=#intercepting-commands>Intercepting commands.</a></li><li><a href=#interceptor-processor>Interceptor processor.</a></li><li><a href=#before>@Before.</a></li><li><a href=#after>@After.</a></li><li><a href=#after-throwing>@AfterThrowing.</a></li><li><a href=#around>@Around.</a></li></ul></li><li>Unit testing commands<ul><li>commangular-mocks module</li></ul></li><li>Backendless development with commangular<ul><li>commangular-spoof module</li></ul></li></ul><h2><a name=installation></a>Installation</h2><hr><ul><li>Using bower : <code>bower install commangular</code></li><li>Download it and add commangular.js or commangular.min.js to your index.html.</li></ul><p>Remember to add commangular.js after angular.js. Commangular only depends on angularJs, it is not using other libraries.</p><h2><a name=quick-guide></a>Quick Guide</h2><hr><p><em>Add commangular to your app.</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Add as a module dependency</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>,[</span><span class=s1>&#39;commangular&#39;</span><span class=p>])</span>
</code></pre></div><p><em>Create a command using the commangular namespace</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//hello-world-command.js</span>
<span class=c1>//You can inject the same that you inject in services or controllers</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;HelloWorldCommand&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>
      <span class=c1>//You can inject at method as well and remember that the name of the method must be &quot;execute&quot;</span>
      <span class=c1>//$http is not going to be used, is just to demostrate the injection on method</span>
        <span class=nx>execute</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;$http&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$http</span><span class=p>)</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Hello from my first command&#39;</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
</code></pre></div><p><em>Create a config block and inject the commangular provider.</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Config block in commands-config.js for example</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>config</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>)</span> <span class=p>{</span>

  <span class=c1>// Commands configuration goes here.</span>
  <span class=c1>//Create your sequence or parallel command structure and map it to an event name string</span>
  <span class=nx>$commandgularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asSequence</span><span class=p>()</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;HelloWorldCommand&#39;</span><span class=p>);</span>
   <span class=p>});</span>
</code></pre></div><p><em>Inject the commangular service in your controller.</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Regular angular controller</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>&#39;MyCtrl&#39;</span><span class=p>,[</span><span class=s1>&#39;$commangular&#39;</span><span class=p>,</span><span class=s1>&#39;$scope&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$commangular</span><span class=p>,</span><span class=nx>$scope</span><span class=p>)</span> <span class=p>{</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>onButtonClick</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
      <span class=nx>$commangular</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>);</span>
    <span class=p>}</span>

   <span class=p>});</span>
</code></pre></div><p><em>You can dispatch directly from any scope as well</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Regular angular controller</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>&#39;MyCtrl&#39;</span><span class=p>,[</span><span class=s1>&#39;$scope&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$scope</span><span class=p>)</span> <span class=p>{</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>onButtonClick</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
      <span class=nx>$scope</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>);</span>
    <span class=p>}</span>

   <span class=p>});</span>
</code></pre></div><p><em>Or you can dispatch directly from the view</em></p><div class=highlight><pre><code class="html language-html" data-lang=html><span class=nt>&lt;div</span> <span class=na>ng-controller=</span><span class=s>&quot;CommandCtrl&quot;</span><span class=nt>&gt;</span>
   <span class=nt>&lt;button</span> <span class=na>ng-click=</span><span class=s>&quot;dispatch(&#39;HelloEvent&#39;)&quot;</span><span class=nt>&gt;</span>Click Me<span class=nt>&lt;/button&gt;</span>
<span class=nt>&lt;/div&gt;</span>
</code></pre></div><p>You will see the message &quot;Hello from my first command&quot; in the logs when the HelloEvent is dispatched, so the command has been executed.</p><h2><a name=creating-commands></a>Creating commands</h2><hr><h3><a name=commangular-namespace></a>Commangular namespace</h3><p>All the commands created by commangular are saved in the &quot;commangular&quot; namespace.The &quot;commangular&quot; namespace is attached to the window object.There is a function attached to this namespace called commangular.create(). With this function you will be able to add new commands to the namespace.</p><h3><a name=how-to-create-commands></a>How to create commands</h3><p>The create() function has this parameters :</p><p><em>commangular.create([CommandName],[CommandFunction],[CommandConfig])</em></p><ul><li><em>CommandName</em> : It&#39;s the name of the command you are creating. It&#39;s useful to reference the command from the command provider.</li><li><em>CommandFunction</em> : It&#39;s the function that will be executed when commangular runs this command. It can be a normal function or an array with parameters. Same as angular syntax</li><li><em>CommandConfig</em> : It&#39;s and object with paramaters to configure the command execution.</li></ul><p>You can invoke the create function like this :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Command with the $log injected from angular</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command1 executed&#39;</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>

<span class=c1>//Command with the $log injected in the execute method</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span><span class=p>[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command1 executed&#39;</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>});</span>

<span class=c1>//Command telling commangular to keep the result in the result1 key in the execution context where Command1 is running using a command config object</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command1 executed&#39;</span><span class=p>);</span>
          <span class=k>return</span> <span class=s2>&quot;This is going to be available on result1 key&quot;</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}],{</span><span class=nx>resultKey</span><span class=o>:</span><span class=s1>&#39;result1&#39;</span><span class=p>});</span>
</code></pre></div><h3><a name=the-command-config-object></a>The command config object</h3><p>To setup the command execution, you can send to the create function an object with some properties inside. At this moment there is just one property you can set in the config object, but there will be more properties in the future.</p><p>Available properties :</p><ul><li>&#39;resultKey&#39; : This property instruct commangular to keep the value returned by the command in the value key passed in &#39;resultKey&#39;. It has to be a string. It means that after the execution of this commands you will be able to inject on the next command using that key and the result of the command will be injected.</li></ul><h3><a name=returning-result-from-commands></a>Returning result from commands</h3><p>There are two main concepts you have to think when you return a value from a command.* You always can inject that result on the next command using the property key lastResult like this :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Suppose this commands are executed on sequence</span>

<span class=c1>//Command that returns the result</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=s2>&quot;This will be injected on the next command&quot;</span>        
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
<span class=c1>//Command that get the lastResult injected</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=s1>&#39;lastResult&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>,</span><span class=nx>lastResult</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>//this will print &quot;This will be injected on the next command&quot;</span>
            <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>lastResult</span><span class=p>);</span> 
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
</code></pre></div><ul><li>If you want the result of that command to be available for injection for all the execution context you have to use the command config like that :</li></ul><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Suppose this commands are executed on sequence</span>

<span class=c1>//Command that returns the result</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=s2>&quot;This will be injected on the next command&quot;</span>        
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}],{</span><span class=nx>resultKey</span><span class=o>:</span><span class=s1>&#39;theResult&#39;</span><span class=p>});</span> <span class=c1>//instructing commangular to keep that result.</span>

<span class=c1>//Command that get the result injected</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=s1>&#39;theResult&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>,</span><span class=nx>theResult</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>//this will print &quot;This will be injected on the next command&quot;</span>
            <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>theResult</span><span class=p>);</span> 
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
<span class=c1>//This command will get the result from the Command1 as well.</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=s1>&#39;theResult&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>,</span><span class=nx>theResult</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>//this will print &quot;This will be injected on the next command&quot;</span>
            <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>theResult</span><span class=p>);</span> 
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
</code></pre></div><p>If the command is asynchronous it should return a promise. At the moment, all the promises are managed by commangular, so if you make an http call and you get a promise as a result you can return that promise. Commangular will wait until the promise is resolved or rejected. If the promise is resolved, the result will be available to the next command. if the promise is rejected all the command context execution is cancelled.</p><p>In the future you will be able to instruct commangular to use the promise as a result value and not to wait to promise resolution.</p><h2><a name=using-the-provider></a>Using The Provider.</h2><hr><p>All the command configuration of your application is done in an angular config block and with the $commangularProvider. The provider is responsible to build the command strutures and map them to the desired event names. You can create multiple configs blocks in angular, so you can have multiple command config blocks to separate functional parts of your application.</p><h3><a name=building-command-sequences></a>Building command sequences.</h3><p>A command sequence is a group of commands where the execution of the next command doesn&#39;t happen until the preceding command completes it&#39;s execution and the result value has been resolved.</p><p>Example :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command1 executed&#39;</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command2 executed&#39;</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command3 executed&#39;</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>

<span class=c1>//We create the sequence in a config block as follows</span>

<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;MyEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asSequence</span><span class=p>()</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>);</span>
</code></pre></div><p>When you dispatch &#39;MyEvent&#39; from the commangular service, the Command1 is going to be executed. After completion, the Command2 will be executed and then the Command3.</p><p>This happens in a synchronous execution, but what happen if some command has an asynchronous execution???. The result resolution will be explained below in the documentation, but if Command1 is using $http and getting a promise, you can return that promise from the Command1 execute function and Command2 will not be executed until that promise has been resolved.</p><h3><a name=building-parallel-commands></a>Building parallel commands.</h3><p>The main diference with sequeces is that the commands running in a parallel group don&#39;t wait for the execution of the others commands in the group.</p><p>It has not sense to use parallel commands, if these commands are not returning a promise. Javascript has just one thread of execution so it is not posible to run synchronous commands at the same time.It&#39;s a perfect fit for http request. While the http request is waiting the response other commands can be executed.</p><p>Suppose this :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,[</span><span class=s1>&#39;$http&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$http</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=kd>var</span> <span class=nx>promise</span> <span class=o>=</span> <span class=nx>$http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/user/list.json&#39;</span><span class=p>);</span>
          <span class=k>return</span> <span class=nx>promise</span><span class=p>;</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Command2 executed&#39;</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>

<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;ParallelExampleEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asParallel</span><span class=p>()</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>);</span>
</code></pre></div><p>The execution of Command1 returns a promise. Command2 won&#39;t wait for this promise resolution. So, in this example, Command2 will complete the execution before Command1.</p><h3><a name=building-command-flows></a>Building command flows</h3><p>A command flow is a decision point inside the command group.You can have any number of flows inside a command group and nesting them how you perfer.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;FlowsEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span> <span class=c1>// returns &quot;result1&quot;</span>
   <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asFlow</span><span class=p>()</span>
   <span class=c1>// Command2 will be executed only if the value of the preceding &quot;result1&quot; is true.</span>
      <span class=p>.</span><span class=nx>resultLink</span><span class=p>(</span><span class=s1>&#39;result1&#39;</span><span class=p>,</span><span class=kc>true</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>)</span>
   <span class=c1>// Command3 will be executed only if the value of the property &quot;isAdmin&quot; of &quot;userModel&quot; service is true.   </span>
      <span class=p>.</span><span class=nx>serviceLink</span><span class=p>(</span><span class=s1>&#39;userModel&#39;</span><span class=p>,</span><span class=s1>&#39;isAdmin&#39;</span><span class=p>,</span><span class=kc>true</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>))</span> 
</code></pre></div><p>You have two options to link on flows :</p><ul><li>resultLink : It links the command execution to the value of a preceding result. As you can see in the example, Command1 returns &quot;result1&quot; and then in the flow &quot;resultLink&quot; uses that value to decide wether &#39;Command2&#39; should be executed.</li><li>serviceLink : It links the command execution to the actual value of an angular service. As you can see in the example, if &quot;userModel.isAdmin == true&quot; then Command3 will be executed. The evaluation of the condition is done every time the FlowsEvent is dispatched, so if &quot;userModel.isAdmin = false&quot;, The next time the FlowsEvent is dispatched &#39;Command3&#39; won&#39;t be executed.</li></ul><p>The link can be done to any kind of command group :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=kd>var</span> <span class=nx>sequence</span> <span class=o>=</span> <span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asSequence</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Seq1Command&#39;</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Seq2Command&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>parallel</span> <span class=o>=</span> <span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asParallel</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Par1Command&#39;</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Par2Command&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>otherFlow</span> <span class=o>=</span> <span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asFlow</span><span class=p>().</span><span class=nx>serviceLink</span><span class=p>(</span><span class=s1>&#39;userModel&#39;</span><span class=p>,</span><span class=s1>&#39;logged&#39;</span><span class=p>,</span><span class=kc>true</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=s1>&#39;UserLoggedCommand&#39;</span><span class=p>);</span>

<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;FlowsEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span> <span class=c1>// returns &quot;result1&quot;</span>
   <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asFlow</span><span class=p>()</span>
   <span class=c1>// Link to sequence</span>
      <span class=p>.</span><span class=nx>resultLink</span><span class=p>(</span><span class=s1>&#39;result1&#39;</span><span class=p>,</span><span class=kc>true</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=nx>sequence</span><span class=p>)</span>
   <span class=c1>// Link to parallel   </span>
      <span class=p>.</span><span class=nx>serviceLink</span><span class=p>(</span><span class=s1>&#39;userModel&#39;</span><span class=p>,</span><span class=s1>&#39;isAdmin&#39;</span><span class=p>,</span><span class=kc>true</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=nx>parallel</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>resultLink</span><span class=p>(</span><span class=s1>&#39;result1&#39;</span><span class=p>,</span><span class=kc>false</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=nx>otherFlow</span><span class=p>));</span> 
</code></pre></div><h2><a name=nesting-commands></a>Nesting commands</h2><hr><p>You can create any kind of commands nesting with commangular. You can create a sequence of parallel commands or sequences in parallel. It&#39;s better to show it in code :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//You can user vars</span>
<span class=kd>var</span> <span class=nx>parallel1</span> <span class=o>=</span> <span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asParallel</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command4&#39;</span><span class=p>).</span><span class=nx>create</span><span class=p>();</span>

<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;ParallelExampleEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asSequence</span><span class=p>()</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>parrallel</span><span class=p>);</span>

<span class=c1>//You can use inline</span>

<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;ParallelExampleEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asSequence</span><span class=p>()</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asParallel</span><span class=p>()</span>
         <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>)</span>
         <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command4&#39;</span><span class=p>));</span>

<span class=c1>//Any level of nesting is allowed and all commands are executed in the same comand context</span>
<span class=c1>//You can reuse commands in the same or others command groups</span>
<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;ParallelExampleEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asSequence</span><span class=p>()</span>
     <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span>
     <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>)</span>
     <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asParallel</span><span class=p>()</span>
            <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commandgularProvider</span><span class=p>.</span><span class=nx>asParrallel</span><span class=p>()</span>
                  <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command7&#39;</span><span class=p>)</span>
                  <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>))</span>
            <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command4&#39;</span><span class=p>));</span>

<span class=c1>//Nesting with flows</span>

<span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;ParallelExampleEvent&#39;</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>asSequence</span><span class=p>()</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>)</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asFlow</span><span class=p>()</span>
         <span class=p>.</span><span class=nx>resultLink</span><span class=p>(</span><span class=s1>&#39;result1&#39;</span><span class=p>,</span><span class=s1>&#39;isAdmin&#39;</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=s1>&#39;Command4&#39;</span><span class=p>)</span>
         <span class=p>.</span><span class=nx>serviceLink</span><span class=p>(</span><span class=s1>&#39;userProfile&#39;</span><span class=p>,</span><span class=s1>&#39;isAdmin&#39;</span><span class=p>,</span><span class=kc>false</span><span class=p>).</span><span class=nx>to</span><span class=p>(</span><span class=s1>&#39;Command4&#39;</span><span class=p>))</span>
      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>$commangularProvider</span><span class=p>.</span><span class=nx>asParallel</span><span class=p>()</span>
         <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command3&#39;</span><span class=p>)</span>
         <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command4&#39;</span><span class=p>));</span>
</code></pre></div><h2><a name=command-execution></a>Command Execution.</h2><hr><h3><a name=dispatching-events></a>Dispatching events.</h3><p>Events in commangular are just strings. When an event is dispatched, commangular executes the command group mapped to that string. There are three ways to dispatch an event in commangular :</p><p><em>Dispatching from $commangular service</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//You can inject $commangular in any controller or service</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>&#39;MyCtrl&#39;</span><span class=p>,[</span><span class=s1>&#39;$commangular&#39;</span><span class=p>,</span><span class=s1>&#39;$scope&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$commangular</span><span class=p>,</span><span class=nx>$scope</span><span class=p>)</span> <span class=p>{</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>onButtonClick</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
      <span class=nx>$commangular</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>);</span> <span class=c1>// Dispatching here</span>
    <span class=p>}</span>

   <span class=p>});</span>
</code></pre></div><p><em>Dispatching from any scope</em></p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//commangular attach a function &#39;dispatch&#39; to the $rootScope</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>&#39;MyCtrl&#39;</span><span class=p>,[</span><span class=s1>&#39;$scope&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$scope</span><span class=p>)</span> <span class=p>{</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>onButtonClick</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
      <span class=nx>$scope</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>);</span> <span class=c1>// Dispatching here</span>
    <span class=p>}</span>

   <span class=p>});</span>
</code></pre></div><p><em>Dispatching from the view</em></p><div class=highlight><pre><code class="html language-html" data-lang=html><span class=c>&lt;!--There is a function &#39;dispatch&#39; on every scope, so you can dispatch directly in your html code--&gt;</span>
<span class=nt>&lt;div</span> <span class=na>ng-controller=</span><span class=s>&quot;CommandCtrl&quot;</span><span class=nt>&gt;</span>
   <span class=nt>&lt;button</span> <span class=na>ng-click=</span><span class=s>&quot;dispatch(&#39;HelloEvent&#39;)&quot;</span><span class=nt>&gt;</span>Click Me<span class=nt>&lt;/button&gt;</span>
<span class=nt>&lt;/div&gt;</span>
</code></pre></div><p>All events dispatched return a promise, so you can control when a command group has completed the execution like that:</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//exactly what you&#39;d do with any promise</span>
<span class=nx>$scope</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=nx>result</span><span class=p>(){},</span><span class=kd>function</span> <span class=nx>error</span><span class=p>(){})});</span>
</code></pre></div><h3><a name=passing-data-to-commands-at-dispatching-time></a>Passing data to commands at dispatching time.</h3><p>If you want to send some data to the command group at dispatching you can do it using the second param of the dispatch function.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//commangular attach a function &#39;dispatch&#39; to the $rootScope</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;YourApp&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>&#39;MyCtrl&#39;</span><span class=p>,[</span><span class=s1>&#39;$scope&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$scope</span><span class=p>)</span> <span class=p>{</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>onButtonClick</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
      <span class=nx>$scope</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;HelloEvent&#39;</span><span class=p>,{</span><span class=nx>username</span><span class=o>:</span><span class=s1>&#39;mandril&#39;</span><span class=p>});</span> <span class=c1>// Dispatching with data &#39;username&#39;</span>
    <span class=p>}</span>

   <span class=p>});</span>

<span class=c1>//Then you can inject &#39;username&#39; on all commands in that context.</span>

<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;HelloWorldCommand&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=s1>&#39;username&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>,</span><span class=nx>username</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Username is :&#39;</span> <span class=o>+</span> <span class=nx>username</span><span class=p>);</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
</code></pre></div><h3><a name=the-command-execution-context></a>The command execution context.</h3><p>Every time an event is dispatched, a new command context is created. Every command context runs isolated from other command context.The command context is responsible for execute the command group, organize the correct injections for every command and instatiate the commands before the execution using the angular injector.You can launch 100 times the same event and all of them will be executed at the same time, but on diferents context, so you can&#39;t inject results from commands running in a diferent context.</p><h3><a name=command-livecycle></a> Command livecycle.</h3><p>Every command is instantitated before the execution using the angular injector and then the command execute function is invoked using the injector as well. The command is discarted after that. So don&#39;t think of command as a singleton. There is a new instance for every invocation.</p><h3><a name=injection-from-angular-context></a> Injection from angular context.</h3><p>Commands are instantiated using the angular injector, so you can inject any angular service the same way you&#39;d do in a service or controller.You can inject on constructor or method (execute method) and there isn&#39;t diference, but the recomended way is to do it in constructor.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;HelloWorldCommand&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=s1>&#39;$http&#39;</span><span class=p>,</span><span class=s1>&#39;MyService&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>,</span><span class=nx>$http</span><span class=p>,</span><span class=nx>MyService</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=c1>//Some code using the injected content here.</span>
        <span class=p>}]</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>
</code></pre></div><h3><a name=returning-promises-from-commands></a>Returning promises from commands.</h3><p>All commands can return a promise. When a command return a promise commangular wait until the promise resolution.</p><p>on sequences :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$timeout</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=kd>var</span> <span class=nx>promise</span> <span class=o>=</span> <span class=nx>$timeout</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span>
            <span class=k>return</span> <span class=s1>&#39;Result from promise&#39;</span><span class=p>;</span>
          <span class=p>},</span><span class=mi>2000</span><span class=p>);</span>
          <span class=k>return</span> <span class=nx>promise</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>},{</span><span class=nx>resultKey</span><span class=o>:</span><span class=s1>&#39;result&#39;</span><span class=p>});</span> <span class=c1>//Keep the result in the command context in key &#39;result&#39;</span>

<span class=c1>//This command won&#39;t be executed until the promise from Command1 is resolved.</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(,</span><span class=nx>$log</span><span class=p>,</span><span class=nx>result</span><span class=p>)</span> <span class=p>{</span> <span class=c1>//Inject the key result</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span> <span class=c1>//This will log &quot;Result from promise&quot;  </span>
        <span class=p>}</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>

<span class=nx>provider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;PromisesEvent&#39;</span><span class=p>).</span><span class=nx>asSequece</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>);</span>
</code></pre></div><p>parallels work diferently with promises :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$timeout</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=kd>var</span> <span class=nx>promise</span> <span class=o>=</span> <span class=nx>$timeout</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span>
            <span class=k>return</span> <span class=s1>&#39;Result from promise&#39;</span><span class=p>;</span>
          <span class=p>},</span><span class=mi>2000</span><span class=p>);</span>
          <span class=k>return</span> <span class=nx>promise</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>},{</span><span class=nx>resultKey</span><span class=o>:</span><span class=s1>&#39;result&#39;</span><span class=p>});</span> <span class=c1>//Keep the result in the command context in key &#39;result&#39;</span>

<span class=c1>//This command will be executed at the same time that Command1</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(,</span><span class=nx>$log</span><span class=p>,</span><span class=nx>result</span><span class=p>)</span> <span class=p>{</span> <span class=c1>//This will throw an exception because result can&#39;t be injected</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span> 
        <span class=p>}</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}]);</span>

<span class=nx>provider</span><span class=p>.</span><span class=nx>mapTo</span><span class=p>(</span><span class=s1>&#39;PromisesEvent&#39;</span><span class=p>).</span><span class=nx>asParallel</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;Command2&#39;</span><span class=p>);</span>
</code></pre></div><h2><a name=command-aspects-advanced-interception></a> Command Aspects (Advanced interception).</h2><hr><h3><a name=intercepting-commands></a>Intercepting commands.</h3><p>Interception is one of the most interesting things in commangular. It will allow you control when a command has to be executed or not, override command results, update data before the command instanciation, capture exceptions throwed by commands etc etc.If you are familiar with Spring AOP it will look very familiar to you, of course it is not as powerfull as Spring AOP, but it has some similarities.</p><p>to define an interceptor :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=nx>InterceptorDescriptor</span><span class=p>,</span><span class=nx>InterceptionFunction</span><span class=p>,</span><span class=nx>Order</span><span class=p>)</span>

<span class=c1>//Example</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/regexp/)&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=c1>// Interception code here</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>},</span><span class=mi>2</span><span class=p>);</span>
</code></pre></div><h4>Interceptor descriptor</h4><p>The interceptor descriptor has two parts &#39;Where&#39; and &#39;What&#39;.Where do you want to intercept? you&#39;ve 4 options :* @Before : The interceptor will be executed before the command. You will be able to cancel the command or modify the data that will be injected in the command or do some other operation you need before the command execution.* @After : The interceptor will be executed just after the command and before any other next command. You can get the lastResult from the command, cancel execution etc etc.* @AfterThrowing : This interceptor will be executed if the command or any interceptor of the command throws an exception. You can get the error throwed injected to do what you need.* @Around : The interceptor is executed around a command.That means that a especial object &#39;processor&#39; will be injected in the interceptor and you can invoke the command or the next interceptor. It will be better explained below.</p><p>The second part of the interceptor descriptor is what command or commands I want to intercept. It is a regular expresion maching the name of the command.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Example</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/Secured/)&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(){})</span> <span class=c1>// any command name that contains &#39;Secured&#39;</span>

<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@After(/Secured\b/)&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(){})</span> <span class=c1>// any command name that ends with &#39;Secured&#39;</span>

<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@After(/\bcom.security/)&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(){})</span> <span class=c1>// any command name that starts with &#39;com.security&#39;</span>

<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@AfterThrowing(/.*/)&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(){})</span> <span class=c1>// any command</span>

<span class=c1>//And any combination you can do with regular expresions.</span>
</code></pre></div><h4>Interception function</h4><p>The same as commands, you can use a function or an array to support minification. The function is instantiated with the injector, so you can inject any angular service and others objects like &quot;lastResult&quot;, &quot;lastError&quot; , &quot;processor&quot;, etc</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Example</span>
<span class=c1>//We want execute the interceptor before Command1</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;userProfile&#39;</span><span class=p>,</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>userProfile</span><span class=p>,</span><span class=nx>processor</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>userProfile</span><span class=p>.</span><span class=nx>isLogged</span><span class=p>)</span>
               <span class=nx>processor</span><span class=p>.</span><span class=nx>cancel</span><span class=p>();</span> <span class=c1>//Canceling the command group execution because the user is not logged.</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>}]);</span>
</code></pre></div><h4>Order</h4><p>You can chain any number of interceptors to the same command, so if you need to executed the interceptor in a specific order you can indicate it here. An order of 0 is assigned by default.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;This will be executed before&#39;</span><span class=p>)</span> 
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>}],</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// this will be executed before the second interceptor</span>

<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;$log&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;this will be executed after&#39;</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>}],</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// this is a bigger number so it executes after</span>
</code></pre></div><h3><a name=interceptor-processor></a>Interceptor processor</h3><p>All command can be injected with a &#39;processor&#39; object :</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=nx>processor</span><span class=p>.</span><span class=nx>getData</span><span class=p>(</span><span class=s1>&#39;result1&#39;</span><span class=p>)</span> <span class=c1>// get data from the current context</span>
          <span class=nx>processor</span><span class=p>.</span><span class=nx>setData</span><span class=p>(</span><span class=s1>&#39;result1&#39;</span><span class=p>,</span><span class=mi>25</span><span class=p>)</span> <span class=c1>// Update the key &#39;result1&#39; with value 25</span>
          <span class=nx>processor</span><span class=p>.</span><span class=nx>cancel</span><span class=p>();</span> <span class=c1>// Cancelation of the current command context execution</span>

        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>});</span> 
</code></pre></div><p>The @Around interceptor has a special method &#39;invoke&#39; to execute the next element in the chain of interceptors or the command itself</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Around(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

          <span class=c1>//Some code here</span>

          <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>processor</span><span class=p>.</span><span class=nx>invoke</span><span class=p>();</span>

          <span class=c1>//Some other code here</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>});</span> 
</code></pre></div><h3><a name=before></a> @Before</h3><p>This interceptor is executed just before the command and allow you update the data is going to be injected or cancel the command execution</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Example checking authentication before the execution</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Before(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=s1>&#39;userProfile&#39;</span><span class=p>,</span><span class=s1>&#39;$q&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>,</span><span class=nx>userProfile</span><span class=p>,</span><span class=nx>$q</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>userProfile</span><span class=p>.</span><span class=nx>isLogged</span><span class=p>)</span> <span class=p>{</span>

            <span class=kd>var</span> <span class=nx>deferred</span> <span class=o>=</span> <span class=nx>$q</span><span class=p>.</span><span class=nx>defer</span><span class=p>();</span>
            <span class=c1>//Show popup for login and wait response callback here</span>
            <span class=c1>//......</span>
            <span class=nx>onCallback</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span>

               <span class=k>if</span><span class=p>(</span><span class=nx>userProfile</span><span class=p>.</span><span class=nx>isLogged</span><span class=p>)</span>
                  <span class=nx>deferred</span><span class=p>.</span><span class=nx>resolve</span><span class=p>();</span>
               <span class=k>else</span>
                  <span class=nx>deferred</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=s1>&#39;User not logged in&#39;</span><span class=p>);</span>
            <span class=p>});</span>
            <span class=k>return</span> <span class=nx>deferred</span><span class=p>.</span><span class=nx>promise</span>
         <span class=p>}</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>});</span> 
</code></pre></div><h3><a name=after></a> @After</h3><p>This intercetor is executed just after the command execution and it can get the result from the command.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

   <span class=k>return</span> <span class=p>{</span>

         <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

            <span class=k>return</span> <span class=mi>25</span>
         <span class=p>}</span>
   <span class=p>}</span>
<span class=p>});</span>


<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@After(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=s1>&#39;lastResult&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>,</span><span class=nx>lastResult</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=nx>expect</span><span class=p>(</span><span class=nx>lastResult</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>25</span><span class=p>);</span>
         <span class=k>if</span><span class=p>(</span><span class=nx>result</span> <span class=o>&lt;</span> <span class=mi>25</span><span class=p>)</span>
            <span class=nx>processor</span><span class=p>.</span><span class=nx>cancel</span><span class=p>();</span> <span class=c1>// The chain of command is broken here</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>});</span> 
</code></pre></div><h3><a name=after-throwing></a> @AfterThrowing</h3><p>This intercetor is executed when a command or an interceptor of that command throw an exception.</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

   <span class=k>return</span> <span class=p>{</span>

         <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

            <span class=kd>var</span> <span class=nx>x</span> <span class=o>=</span> <span class=mi>100</span><span class=o>/</span><span class=mi>0</span><span class=p>;</span> <span class=c1>// Division by 0 throw exception infinite</span>
            <span class=k>return</span> <span class=mi>25</span>
         <span class=p>}</span>
   <span class=p>}</span>
<span class=p>});</span>


<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@AfterThrowing(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=s1>&#39;lastError&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>,</span><span class=nx>lastError</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=nx>expect</span><span class=p>(</span><span class=nx>lastError</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;Infinity&#39;</span><span class=p>);</span> <span class=c1>//The execution of the command is canceled after exceptions</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>});</span> 
</code></pre></div><h3><a name=around></a> @Around</h3><p>This is the most powerfull interceptor in commangular. It will allow you change data before, after, or event bypass a command execution in a chain. Cause this interceptor is the most complicated to understand as well, It&#39;s going to be explianed with an example. Below you will see two @Around interceptor on &#39;Command1&#39;</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=c1>//Dispatcher for execution</span>
<span class=nx>$scope</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=s1>&#39;AroundEvent&#39;</span><span class=p>,{</span><span class=nx>data1</span><span class=o>:</span><span class=mi>25</span><span class=p>});</span> <span class=c1>//Data passed to the command context</span>

<span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>data1</span><span class=p>,</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

   <span class=k>return</span> <span class=p>{</span>

         <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

            <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data1</span><span class=p>)</span> <span class=c1>//this log &#39;50&#39;</span>
            <span class=k>return</span> <span class=mi>100</span><span class=p>;</span>
         <span class=p>}</span>
   <span class=p>}</span>
<span class=p>});</span>

<span class=c1>//First interceptor</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Around(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=kd>var</span> <span class=nx>data1</span> <span class=o>=</span> <span class=nx>processor</span><span class=p>.</span><span class=nx>getData</span><span class=p>(</span><span class=s1>&#39;data1&#39;</span><span class=p>);</span>
         <span class=nx>expect</span><span class=p>(</span><span class=nx>data1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>25</span><span class=p>);</span> <span class=c1>//The data1 should be 25</span>
         <span class=nx>processor</span><span class=p>.</span><span class=nx>setData</span><span class=p>(</span><span class=s1>&#39;data1&#39;</span><span class=p>,</span><span class=mi>50</span><span class=p>);</span>
         <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>processor</span><span class=p>.</span><span class=nx>invoke</span><span class=p>();</span> <span class=c1>//The second interceptor is executed here</span>
         <span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>75</span><span class=p>)</span> <span class=c1>// The return from second interceptor </span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>},</span><span class=mi>1</span><span class=p>);</span>
<span class=c1>//Second interceptor</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Around(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>,</span><span class=nx>data1</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=nx>expect</span><span class=p>(</span><span class=nx>data1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span> <span class=c1>// the data1 has been modified by the first interceptor</span>
         <span class=nx>data1</span><span class=o>++</span> <span class=c1>//This is not changing the value in the context</span>
         <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>processor</span><span class=p>.</span><span class=nx>invoke</span><span class=p>()</span> <span class=c1>// The command is executed here (The last component in the chain)</span>
         <span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=c1>//The result from the command</span>
         <span class=k>return</span> <span class=mi>75</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>},</span><span class=mi>2</span><span class=p>);</span> 
</code></pre></div><p>One example bypassing a command</p><div class=highlight><pre><code class="javascript language-javascript" data-lang=javascript><span class=nx>commangular</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;Command1&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>$log</span><span class=p>)</span> <span class=p>{</span>

   <span class=k>return</span> <span class=p>{</span>

         <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

            <span class=nx>$log</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;This is not going to be executed&#39;</span><span class=p>);</span> 
            <span class=k>return</span> <span class=mi>10</span><span class=p>;</span>
         <span class=p>}</span>
   <span class=p>}</span>
<span class=p>});</span>

<span class=c1>//First interceptor</span>
<span class=nx>commangular</span><span class=p>.</span><span class=nx>aspect</span><span class=p>(</span><span class=s1>&#39;@Around(/Command1/)&#39;</span><span class=p>,[</span><span class=s1>&#39;processor&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>processor</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>return</span> <span class=p>{</span>

        <span class=nx>execute</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>

         <span class=c1>//processor.invoke(); //The line is not executed,so command is not executed</span>
         <span class=k>return</span> <span class=mi>100</span><span class=p>;</span> <span class=c1>//This is considered the return from the command instead</span>
        <span class=p>}</span>
      <span class=p>}</span>
<span class=p>},</span><span class=mi>1</span><span class=p>);</span>
</code></pre></div></div><div class=footer><div class="footer-data text-center"><div>Commangular 0.5.2 | Created by <a href=https://twitter.com/FlashMandril target=_blank>Jess Barqun.</a></div><div>Code licensed under <a href=http://opensource.org/licenses/mit-license.html target=_blank>MIT License.</a> Documentation licensed under <a href=http://creativecommons.org/licenses/by/3.0/>CC 3.0</a></div><div>This website is using <a href=http://fontawesome.io/ target=_blank>Font Awesome</a>, <a href=http://getbootstrap.com/ target=_blank>Twitter Bootstrap</a> and <a href=http://jekyllrb.com/ target=_blank>Jekyll</a></div><div><a href=https://github.com/yukatan/commangular target=_blank>Github Repository</a></div></div></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script>window.jQuery || document.write('<script src="/_bower_components/jquery.js"><\/script>')</script><script src=/js/e763.script.js></script><script type=text/javascript>var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46287627-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();</script></body></html>